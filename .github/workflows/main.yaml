name: Update database

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 * * * *'

jobs:
  Update_json:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4 
      - uses: mlugg/setup-zig@v1
      - name: download jsons
        run: |
          wget -O ./a.json "https://api.github.com/search/repositories?q=topic:zig-package&page=1&per_page=100"
          wget -O ./b.json "https://api.github.com/search/repositories?q=topic:zig-package&page=2&per_page=100"
          wget -O ./c.json "https://api.github.com/search/repositories?q=topic:zig-package&page=3&per_page=100"
          wget -O ./d.json "https://api.github.com/search/repositories?q=topic:zig-package&page=4&per_page=100"
      - name: Compile zig
        run: zig build-exe ./scripts/database_compiler.zig
      - name: Run zig
        run: ./database_compiler > ./database/main.json
      - name: Ok run
        run: sh ./scripts/featured.sh
      - name: Run
        run: |
           zig build-exe ./scripts/web.zig
           zig build-exe ./scripts/gui.zig
           zig build-exe ./scripts/games.zig
           ./games > ./database/games.json
           ./web > ./database/web.json
           ./gui > ./database/gui.json
      - name: Remove
        run: |
          rm -rf ./a.json
          rm -rf ./b.json
          rm -rf ./c.json
          rm -rf ./d.json
          rm -rf ./database_compiler
          rm -rf ./database_compiler.o
      - name: Config email
        run: git config --global user.name "Github Actions" && git config --global user.email "<>"
      - name: Git add
        run: git add .
      - name: Commit images
        run: git commit -m '[CI] Updated database'
      - name: Push changes
        run: git push
